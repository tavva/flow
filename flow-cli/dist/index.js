#!/usr/bin/env node
"use strict";var E=Object.create;var u=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var O=(t,n)=>{for(var o in n)u(t,o,{get:n[o],enumerable:!0})},w=(t,n,o,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of $(n))!I.call(t,e)&&e!==o&&u(t,e,{get:()=>n[e],enumerable:!(r=V(n,e))||r.enumerable});return t};var a=(t,n,o)=>(o=t!=null?E(j(t)):{},w(n||!t||!t.__esModule?u(o,"default",{value:t,enumerable:!0}):o,t)),A=t=>w(u({},"__esModule",{value:!0}),t);var N={};O(N,{main:()=>b,parseArgs:()=>C});module.exports=A(N);var i=a(require("fs")),g=a(require("path")),P=a(require("os")),v=a(require("readline"));function c(){return g.join(P.homedir(),".config","flow-cli","config.json")}function S(t){let n=t||c();if(!i.existsSync(n))return null;try{let o=i.readFileSync(n,"utf-8");return JSON.parse(o)}catch{return null}}function m(t,n){let o=n||c(),r=g.dirname(o);i.existsSync(r)||i.mkdirSync(r,{recursive:!0}),i.writeFileSync(o,JSON.stringify(t,null,2))}async function h(){let t=v.createInterface({input:process.stdin,output:process.stdout});return new Promise(n=>{t.question("Enter vault path: ",o=>{t.close(),n(o.trim())})})}var l=a(require("fs")),p=a(require("path"));function y(t){let n=t.replace(/^~/,process.env.HOME||"");if(!l.existsSync(n))throw new Error(`Vault not found at ${n}`);let o=p.join(n,".obsidian");if(!l.existsSync(o))throw new Error(`Not a valid Obsidian vault (missing .obsidian folder): ${n}`);let r=p.join(o,"plugins","flow");if(!l.existsSync(r))throw new Error(`Flow plugin not installed at ${r}`);let e=p.join(r,"data.json");try{let s=l.readFileSync(e,"utf-8"),x=JSON.parse(s);if(!x.cliInboxFile)throw new Error(`cliInboxFile not configured in Flow plugin settings
Please open Obsidian and configure: Settings \u2192 Flow GTD Coach \u2192 CLI Inbox File`);return x}catch(s){throw s instanceof Error&&s.message.includes("cliInboxFile")?s:new Error("Could not read Flow plugin settings")}}var f=a(require("fs")),d=a(require("path"));function F(t,n,o){let r=t.replace(/^~/,process.env.HOME||""),e=d.join(r,n),s=d.dirname(e);f.existsSync(s)||f.mkdirSync(s,{recursive:!0}),f.appendFileSync(e,`${o}
`)}function C(t){let n={config:!1};for(let o=0;o<t.length;o++)t[o]==="--vault"&&o+1<t.length?(n.vault=t[o+1],o++):t[o]==="--config"?n.config=!0:n.text||(n.text=t[o]);if(!n.text&&!n.config)throw new Error("Please provide text to capture");return n}async function b(){try{let t=C(process.argv.slice(2));if(t.config){let r=await h();if(m({defaultVault:r}),console.log(`Saved default vault to ${c()}`),!t.text)return}let n=t.vault;if(!n){let r=S();if(r)n=r.defaultVault;else{console.error("No default vault configured.");let e=await h();console.error(`Saving default vault to ${c()}`),m({defaultVault:e}),n=e}}let o=y(n);t.text&&(F(n,o.cliInboxFile,t.text),console.log(`Captured: "${t.text}"`))}catch(t){t instanceof Error?console.error(`Error: ${t.message}`):console.error("An unknown error occurred"),process.exit(1)}}require.main===module&&b();0&&(module.exports={main,parseArgs});
